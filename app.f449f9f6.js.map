{"version":3,"sources":["data/checkins.min.json","assets/app.js"],"names":["module","exports","color","map","mapboxgl","Map","container","style","maxZoom","logoPosition","attributionControl","boxZoom","zoom","$infoCountries","document","getElementById","$infoPlaces","$infoCheckins","$countries","bodyClass","body","classList","startInteractive","add","on","endInteractive","remove","addEventListener","toggleInteractive","toggle","numberWithCommas","x","toString","replace","addControl","AttributionControl","compact","LayersControl","onAdd","createElement","className","linesButton","innerHTML","type","title","visibility","getLayoutProperty","setLayoutProperty","appendChild","NavigationControl","renderNumber","el","number","frames","inc","Math","ceil","num","render","textContent","requestAnimationFrame","data","require","_countries","_places","checkinsCount","features","length","lines","filter","f","i","id","country","properties","isUnique","lng","lat","geometry","coordinates","cc","toLowerCase","bounds","LngLatBounds","places_count","checkins_count","extend","nextFeature","date","nextLng","nextLat","push","placesCount","Object","keys","countries","c","name","countriesCount","sort","a","b","once","forEach","$button","e","fitBounds","padding","layers","getStyle","reverse","labelLayerIdx","findIndex","layer","labelLayerId","undefined","console","log","setLayerZoomRange","addSource","cluster","clusterMaxZoom","clusterRadius","tolerance","buffer","addLayer","source","paint","maxzoom","layout","minzoom","getCanvas","cursor","originalEvent","stopPropagation","flyTo","center","lngLat","getZoom","err","reload","confirm","location","error","window","onerror"],"mappings":"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","file":"app.f449f9f6.js","sourceRoot":"..","sourcesContent":["module.exports = {\"type\":\"FeatureCollection\",\"features\":[{\"type\":\"Feature\",\"properties\":{\"id\":\"4f11ce82e4b07e9ecad0480c\",\"date\":20211207,\"country\":\"United States\",\"cc\":\"US\"},\"geometry\":{\"type\":\"Point\",\"coordinates\":[-95.391,29.745]}},{\"type\":\"Feature\",\"properties\":{\"id\":\"4aca84e9f964a5203cc220e3\",\"date\":20181231,\"country\":\"United States\",\"cc\":\"US\"},\"geometry\":{\"type\":\"Point\",\"coordinates\":[-95.401,29.717]}}]};","const color = '#14B7F4';\n\nconst map = new mapboxgl.Map({\n  container: 'map',\n  style: 'mapbox://styles/cheeaun/ckbm8ln3w15d01ilp38k7xll8',\n  maxZoom: 16,\n  logoPosition: 'top-right',\n  attributionControl: false,\n  boxZoom: false,\n  zoom: 0.1,\n});\n\n// const $info = document.getElementById('info');\nconst $infoCountries = document.getElementById('info-countries');\nconst $infoPlaces = document.getElementById('info-places');\nconst $infoCheckins = document.getElementById('info-checkins');\nconst $countries = document.getElementById('countries');\n\nconst bodyClass = document.body.classList;\nfunction startInteractive() {\n  bodyClass.add('interactive');\n}\nmap.on('dragstart', startInteractive);\nmap.on('zoomstart', startInteractive);\n\nfunction endInteractive() {\n  bodyClass.remove('interactive');\n}\n$countries.addEventListener('touchstart', endInteractive, false);\n$countries.addEventListener('mouseenter', endInteractive);\n\nfunction toggleInteractive() {\n  bodyClass.toggle('interactive');\n}\nmap.on('click', toggleInteractive);\n\nconst numberWithCommas = (x) =>\n  x > 999 ? x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',') : x;\n\nmap.addControl(new mapboxgl.AttributionControl({ compact: true }), 'top-right');\n\nclass LayersControl {\n  onAdd(map) {\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n\n    const linesButton = document.createElement('button');\n    linesButton.innerHTML = `<svg width='20' height='20' viewBox='0 0 24 24'>\n      <path d='M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.5-.07l-3.57 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07L4.93 15.5c.05.15.07.32.07.5 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.5.07l4.57-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56c-.05-.14-.07-.3-.07-.5 0-1.1.9-2 2-2s2 .9 2 2z'/>\n    </svg>`;\n    linesButton.type = 'button';\n    linesButton.title = 'Show/hide journey lines';\n    linesButton.addEventListener(\n      'click',\n      () => {\n        const visibility = map.getLayoutProperty('lines', 'visibility');\n        if (visibility === 'visible') {\n          map.setLayoutProperty('lines', 'visibility', 'none');\n          linesButton.classList.remove('active');\n        } else {\n          map.setLayoutProperty('lines', 'visibility', 'visible');\n          linesButton.classList.add('active');\n        }\n      },\n      false,\n    );\n\n    container.appendChild(linesButton);\n    return container;\n  }\n}\nmap.addControl(new LayersControl(), 'top-right');\n\nmap.addControl(new mapboxgl.NavigationControl(), 'top-right');\n\n// let slider;\n// class PitchControl {\n//   onAdd() {\n//     const container = document.createElement('div');\n//     container.className = 'mapboxgl-ctrl pitch-ctrl';\n\n//     container.innerHTML = `<svg viewBox='0 0 24 24'>\n//       <title>Pitch</title>\n//       <path d='M14 6l-3.8 5 3 3.8-1.7 1.2L7 10l-6 8h22L14 6z'/>\n//     </svg>`;\n\n//     slider = document.createElement('input');\n//     slider.type = 'range';\n//     slider.step = 5;\n//     slider.min = slider.value = 0;\n//     slider.max = 60;\n//     slider.className = 'pitch-slider';\n//     slider.addEventListener('change', (e) => {\n//       map.easeTo({ pitch: e.target.value });\n//     }, false);\n\n//     container.appendChild(slider);\n//     return container;\n//   }\n// }\n// map.addControl(new PitchControl(), 'top-right');\n// map.on('pitchend', () => {\n//   slider.value = map.getPitch();\n// });\n\nfunction renderNumber(el, number) {\n  const frames = 60;\n  const inc = Math.ceil(number / frames);\n  let num = 0;\n  function render() {\n    if (num >= number) return;\n    num = num + inc;\n    if (num > number) num = number;\n    el.textContent = numberWithCommas(num);\n    requestAnimationFrame(render);\n  }\n  requestAnimationFrame(render);\n}\n\nconst data = require('../data/checkins.min.json');\nconst _countries = {};\nconst _places = {};\n\nconst checkinsCount = data.features.length;\n\nconst lines = [];\n\ndata.features = data.features.filter((f, i) => {\n  const { id, country } = f.properties;\n  const isUnique = !_places[id];\n  const [lng, lat] = f.geometry.coordinates;\n  if (isUnique) {\n    if (!_countries[country]) {\n      const cc = f.properties.cc.toLowerCase();\n      _countries[country] = {\n        cc: cc,\n        bounds: new mapboxgl.LngLatBounds(),\n        places_count: 0,\n        checkins_count: 0,\n      };\n    }\n    _countries[country].bounds.extend([lng, lat]);\n    _countries[country].places_count++;\n    _places[id] = true;\n  }\n  _countries[country].checkins_count++;\n\n  const nextFeature = data.features[i + 1];\n  if (nextFeature && f.properties.date === nextFeature.properties.date) {\n    let [nextLng, nextLat] = nextFeature.geometry.coordinates;\n    // Magic below from https://github.com/mapbox/mapbox-gl-js/issues/3250#issuecomment-294887678\n    // This make sure the lines can cross the 180th meridian\n    nextLng += nextLng - lng > 180 ? -360 : lng - nextLng > 180 ? 360 : 0;\n    lines.push([\n      [lng, lat],\n      [nextLng, nextLat],\n    ]);\n  }\n\n  return isUnique;\n});\n\nconst placesCount = Object.keys(_places).length;\n\nconst countries = Object.keys(_countries).map((country) => {\n  const c = _countries[country];\n  return {\n    name: country,\n    cc: c.cc,\n    bounds: c.bounds,\n    places_count: c.places_count,\n    checkins_count: c.checkins_count,\n  };\n});\n\nconst countriesCount = countries.length;\n\ncountries.sort((a, b) => b.places_count - a.places_count);\n\nmap.once('styledata', () => {\n  map.once('load', () => {\n    countries.forEach((country, i) => {\n      const { cc, name, bounds, checkins_count, places_count } = country;\n      const $button = document.createElement('button');\n      $button.type = 'button';\n      $button.addEventListener(\n        'click',\n        (e) => {\n          map.fitBounds(bounds, { padding: 150 });\n        },\n        false,\n      );\n      $button.innerHTML = `\n        <img src=\"data/countries/${cc}.svg\" intrinsicsize=\"50x50\" width=\"50\" height=\"50\" alt=\"\">\n        <br>\n        <b>${name}</b>\n        <br>\n        ${numberWithCommas(checkins_count)} check-in${\n        checkins_count > 1 ? 's' : ''\n      }\n        <br>\n        ${numberWithCommas(places_count)} place${places_count > 1 ? 's' : ''}\n      `;\n      $countries.appendChild($button);\n    });\n  });\n\n  const layers = map.getStyle().layers.reverse();\n  const labelLayerIdx = layers.findIndex(function (layer) {\n    return layer.type !== 'symbol';\n  });\n  const labelLayerId =\n    labelLayerIdx !== -1 ? layers[labelLayerIdx].id : undefined;\n  console.log(layers);\n\n  map.setLayerZoomRange('transit-label', 14, 16);\n\n  map.addSource('checkins', {\n    type: 'geojson',\n    data: data,\n    cluster: true,\n    clusterMaxZoom: 10,\n    clusterRadius: 10,\n    tolerance: 10,\n    buffer: 0,\n  });\n\n  map.addLayer({\n    id: 'cluster',\n    type: 'circle',\n    source: 'checkins',\n    filter: ['has', 'point_count'],\n    paint: {\n      'circle-radius': [\n        'interpolate',\n        ['linear'],\n        ['get', 'point_count'],\n        3,\n        7,\n        10,\n        10,\n        100,\n        13,\n        200,\n        16,\n      ],\n      'circle-color': color,\n      'circle-opacity': 0.9,\n      'circle-stroke-width': [\n        'interpolate',\n        ['linear'],\n        ['get', 'point_count'],\n        3,\n        3,\n        50,\n        6,\n      ],\n      'circle-stroke-color': color,\n      'circle-stroke-opacity': 0.3,\n    },\n  });\n\n  map.addLayer({\n    id: 'checkins-count',\n    type: 'symbol',\n    source: 'checkins',\n    filter: ['has', 'point_count'],\n    maxzoom: 11,\n    layout: {\n      'text-field': '{point_count_abbreviated}',\n      'text-size': 10,\n    },\n  });\n\n  map.addLayer(\n    {\n      id: 'checkins',\n      type: 'circle',\n      source: 'checkins',\n      minzoom: 8,\n      filter: ['!has', 'point_count'],\n      paint: {\n        'circle-radius': 3,\n        'circle-color': color,\n        'circle-opacity': 0.9,\n        'circle-stroke-width': 3,\n        'circle-stroke-color': color,\n        'circle-stroke-opacity': 0.1,\n      },\n    },\n    labelLayerId,\n  );\n\n  map.once('load', () => {\n    requestAnimationFrame(() => {\n      renderNumber($infoCheckins, checkinsCount);\n      renderNumber($infoPlaces, placesCount);\n      renderNumber($infoCountries, countriesCount);\n      bodyClass.add('render');\n    });\n  });\n\n  map.on('mouseenter', 'cluster', () => {\n    map.getCanvas().style.cursor = 'pointer';\n  });\n\n  map.on('click', 'cluster', (e) => {\n    e.originalEvent.stopPropagation();\n    map.flyTo({\n      center: e.lngLat,\n      zoom: map.getZoom() + 2,\n    });\n  });\n\n  map.on('mouseleave', 'cluster', () => {\n    map.getCanvas().style.cursor = '';\n  });\n\n  map.addLayer(\n    {\n      id: 'lines',\n      type: 'line',\n      source: {\n        type: 'geojson',\n        data: {\n          type: 'Feature',\n          geometry: {\n            type: 'MultiLineString',\n            coordinates: lines,\n          },\n        },\n      },\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'line-color': '#fff',\n        'line-opacity': 0.3,\n      },\n    },\n    labelLayerId,\n  );\n\n  // TODO: filter by date\n  // const filterByDate = (startDate, endDate) => {\n  //   map.setFilter('checkins', [\n  //     'all',\n  //     ['>=', 'date', startDate],\n  //     ['<=', 'date', endDate],\n  //     map.getFilter('checkins'),\n  //   ]);\n  // };\n  // filterByDate(20160101, 20161212);\n\n  const err = (e) => {\n    const reload = confirm(\n      'Oops, the map is acting weird now. Reload this page? 😅',\n    );\n    if (reload) location.reload();\n    console.error(e);\n  };\n  map.on('error', err);\n  window.onerror = err;\n});\n"]}